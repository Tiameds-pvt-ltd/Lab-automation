spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/tiameds?charSet=UTF8
    username: postgres
    password: root
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        default_batch_fetch_size: 10

  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB

  mail:
    host: ${SPRING_MAIL_HOST:smtp.gmail.com}
    port: ${SPRING_MAIL_PORT:587}
    username: ${SPRING_MAIL_USERNAME:itadmin@tiameds.ai}
    password: ${SPRING_MAIL_PASSWORD:fpkpxeiacxuqncjm}
    properties:
      mail:
        smtp:
          auth: ${SPRING_MAIL_SMTP_AUTH:true}
          starttls:
            enable: ${SPRING_MAIL_SMTP_STARTTLS_ENABLE:true}

springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /doc

logging:
  level:
    org.springframework: INFO
    org.springframework.security: DEBUG
    com:
      fasterxml:
        jackson: DEBUG

# Server configuration
server:
  port: 8080
  servlet:
    context-path: /api/v1
  base-url: ${SERVER_BASE_URL:http://localhost:8080/api/v1}  # Backend base URL for email links

# Security configuration
security:
  jwt:
    issuer: ${JWT_ISSUER:tiameds-lab-automation}
    audience: ${JWT_AUDIENCE:tiameds-clients}
    access-token-ttl: ${JWT_ACCESS_TOKEN_TTL:PT2M}
    refresh-token-ttl: ${JWT_REFRESH_TOKEN_TTL:P1D}
    private-key-location: classpath:keys/private_key.pem
    public-key-location: classpath:keys/public_key.pem
    access-cookie-name: ${JWT_ACCESS_COOKIE_NAME:accessToken}
    refresh-cookie-name: ${JWT_REFRESH_COOKIE_NAME:refreshToken}
    cookie-domain: ${JWT_COOKIE_DOMAIN:}
    cookie-path: ${JWT_COOKIE_PATH:/}
    cookie-secure: ${JWT_COOKIE_SECURE:false}
    same-site: ${JWT_COOKIE_SAMESITE:Strict}
    subject-encryption-key: ${JWT_SUBJECT_ENCRYPTION_KEY:MTIzNDU2Nzg5MDEyMzQ1Njc4OTAxMjM0NTY3ODkwMTI=}

# Password reset configuration
# Database-backed rate limiting (shared across all instances)
password:
  reset:
    token:
      expiry:
        minutes: ${PASSWORD_RESET_TOKEN_EXPIRY_MINUTES:15}  # Default 15 minutes, optional 30
      length: ${PASSWORD_RESET_TOKEN_LENGTH:32}  # Token length in bytes (32+ recommended)
    url: ${PASSWORD_RESET_URL:http://localhost:3000/reset-password}  # Frontend reset password URL
    rate:
      limit:
        email:
          max: ${PASSWORD_RESET_RATE_LIMIT_EMAIL_MAX:3}  # Max requests per email per window
          window:
            minutes: ${PASSWORD_RESET_RATE_LIMIT_EMAIL_WINDOW:1}  # Time window in minutes
        ip:
          max: ${PASSWORD_RESET_RATE_LIMIT_IP_MAX:3}  # Max requests per IP per window
          window:
            minutes: ${PASSWORD_RESET_RATE_LIMIT_IP_WINDOW:1}  # Time window in minutes


# Onboarding Configuration
onboarding:
  token:
    expiry-minutes: 15  # Token expiration time in minutes (default: 15)
  rate-limit:
    max-emails-per-hour: 3  # Maximum verification emails per hour per email address
    window-minutes: 60  # Rate limit window in minutes
  frontend:
    base-url: http://localhost:3000  # Frontend base URL
    verification-url: http://localhost:3000/verify-email  # Email verification endpoint URL
    onboarding-url: http://localhost:3000/onboarding  # Onboarding form URL
